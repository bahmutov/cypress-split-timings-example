name: split
on:
  # launch this workflow from GitHub Actions page
  workflow_dispatch:
jobs:
  split:
    # https://github.com/bahmutov/cypress-workflows
    uses: bahmutov/cypress-workflows/.github/workflows/split.yml@v2
    with:
      nE2E: 2
      split-file: 'timings.json'
      # show everything during the workflow run
      debug-inputs: true
      debug: cypress-split

  commit-updated-timings:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-22.04
    needs: split
    steps:
      - name: Checkout üõé
        uses: actions/checkout@v4

      - name: Show merged timings üñ®Ô∏è
        run: |
          echo off
          echo split workflow outputs
          echo '${{ needs.split.outputs.merged-timings }}'

      - name: Write updated timings üíæ
        # pretty-print json string into a file
        run: echo '${{ toJson(fromJson(needs.split.outputs.merged-timings)) }}' > timings.json

      - name: Commit changed spec timings ‚è±Ô∏è
        # https://github.com/stefanzweifel/git-auto-commit-action
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: Updated spec timings
          branch: main
          file_pattern: timings.json
